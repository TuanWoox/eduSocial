<% layout('./layouts/indexboilerplate') -%>
<div class="container mt-4">
    <!-- Back to Post List Button -->
    <a href="/posts/" class="btn btn-outline-primary mb-3"><i class="bi bi-arrow-left-circle"></i> Back to Post List</a>
    
    <!-- Post Title -->
    <h1 class="display-4 text-primary mb-4"><%= post.title %></h1>

    <!-- Post Info (Author and Views) -->
    <div class="d-flex mb-4">
        <p class="mb-0 text-muted me-3"><strong>Tác giả:</strong> <%= post.name %></p>
        <p class="mb-0 text-muted"><strong>Lượt xem:</strong> <%= post.views %></p>
    </div>

    <!-- Post Content -->
    <div>
        <p class="h5 font-weight-bold">Nội dung:</p>
        <p class="lead m-2"><%- post.content %></p>
    </div>

    <!-- Edit and Delete Buttons -->
    <div class="d-flex justify-content-between mt-4">
        <a class="btn btn-info btn-lg" href="/posts/<%= post._id %>/edit">Edit</a> 
        <form action="/posts/<%= post._id %>?_method=DELETE" method="POST">
            <button type="submit" class="btn btn-danger btn-lg">Delete</button>
        </form>
    </div>

    <!-- Answers Section -->
    <% if (post.comments && post.comments.length > 0) { %>
        <div class="mt-5">
            <h3 class="h4 mb-3">Answers (<%= post.comments.length %>)</h3>
            <% post.comments.forEach(comment => { %>
                <div class="card my-3 shadow-sm">
                    <div class="card-body">
                        <small class="text-muted">
                            Answered by <strong><%= comment.authorId ? comment.authorId.name : 'Unknown' %></strong> on <%= new Date(comment.createdAt).toLocaleDateString() %>
                        </small>
                        <p class="mt-2"><%= comment.body %></p>

                        <!-- Edit and Delete Answer Buttons -->
                        <div class="d-flex justify-content-end">
                            <a href="/posts/<%= post._id %>/editAnswer/<%= comment._id %>" class="btn btn-outline-primary btn-sm me-2">Edit</a>
                            <form action="/posts/<%= post._id %>/<%= comment._id %>?_method=DELETE" method="POST" class="d-inline">
                                <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>                
            <% }); %>
        </div>
    <% } %>

    <!-- Answer Form -->
    <div class="mt-4">
        <h4 class="h5 font-weight-bold mb-3">Post Your Answer</h4>
        <form action="/posts/<%= post._id %>/sendAnswers" method="POST">
            <div class="mb-3">
                <label for="answer" class="form-label">Your Answer</label>
                <textarea id="answer" name="answer[body]" class="form-control" rows="5" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary btn-lg">Submit Answer</button>
        </form>
    </div>
</div>
